# 🧪 测试新功能指南（一步步来）

> 如果您看不到进度条，请按照这个指南操作

---

## 📋 完整测试步骤

### 第 0 步：刷新浏览器 ⚡

**非常重要！** 先刷新浏览器确保加载最新代码：

1. 在浏览器按 `Ctrl + Shift + R` （强制刷新）
2. 或者按 `F5` 多次刷新
3. 确保看到页面完全重新加载

---

### 第 1 步：打开浏览器控制台 🔍

按 `F12` 打开开发者工具，查看是否有错误：

1. 打开 "Console" (控制台) 标签
2. 查看是否有红色错误信息
3. **如果有错误，截图发给我**

---

### 第 2 步：连接钱包 👛

1. 点击右上角 "Connect Wallet"
2. 选择 MetaMask
3. **确保切换到 Sepolia 测试网**（重要！）
4. 确认连接

---

### 第 3 步：创建测试投票 📝

**重要：** 设置很短的持续时间，方便测试

1. 点击 "Create Poll" 按钮
2. 填写信息：
   ```
   标题：测试解密功能
   选项 1：选项A
   选项 2：选项B
   持续时间：0.02 小时（约 1 分钟）⭐
   ```
3. 点击 "Submit"
4. 在钱包确认交易
5. 等待交易确认

---

### 第 4 步：进行投票 🗳️

1. 点击刚创建的投票进入详情页
2. 选择一个选项（随便选）
3. 点击 "Vote"
4. 确认交易
5. 等待确认

---

### 第 5 步：等待投票结束 ⏰

1. **等待 1-2 分钟**（因为设置了 0.02 小时）
2. 刷新页面 (`F5`)
3. 应该看到投票状态变为 "Ended"

---

### 第 6 步：测试解密功能 ⭐（关键步骤）

**这一步您应该能看到进度条！**

1. 确认投票状态显示为 "Ended"（已结束）

2. 页面应该显示 **"Request Decryption"** 按钮（绿色大按钮）
   
   如果看不到这个按钮，说明：
   - 投票还没结束，再等一会
   - 或者需要刷新页面

3. **点击 "Request Decryption" 按钮**

4. **应该弹出模态框！** 🎊
   ```
   ┌─────────────────────────────────────┐
   │  🔄 提交解密请求...                │
   │  ████░░░░░░░░░░░░░░░░ 10%         │
   └─────────────────────────────────────┘
   ```

5. 在 MetaMask 确认交易

6. **观察进度条变化**：
   - 10-20%：提交请求
   - 20-80%：Gateway 解密中（会持续 30-60 秒）
   - 80-95%：等待回调
   - 100%：完成！

---

## 🔍 如果还是看不到进度条

### 情况 1：没有看到 "Request Decryption" 按钮

**原因：** 投票还没结束

**解决：**
- 查看投票详情页的剩余时间
- 等待时间到期
- 刷新页面

### 情况 2：点击按钮后没有反应

**检查浏览器控制台（F12）：**

1. 如果看到错误 `Cannot read properties of null (reading 'requestDecryption')`
   - 说明合约实例未初始化
   - 刷新页面重试

2. 如果看到错误 `user rejected transaction`
   - 您在钱包中拒绝了交易
   - 重新点击按钮

3. 如果看到错误 `Poll must be ended`
   - 投票还没结束
   - 继续等待

### 情况 3：模态框弹出但立即消失

**可能原因：**
- JavaScript 错误
- 查看控制台错误信息

---

## 🎮 快捷测试方法

### 方法 A：使用现有投票（如果有）

```bash
# 查看现有投票
1. 打开前端：http://localhost:3000
2. 查看投票列表
3. 找一个已经结束的投票
4. 点击进入详情
5. 点击 "Request Decryption"
```

### 方法 B：创建新的快速测试投票

**在前端创建：**
- 持续时间设置为：**0.01 小时** = 36秒
- 这样很快就能测试解密功能

---

## 📸 预期效果截图说明

### 步骤 1：投票结束后
```
┌─────────────────────────────────┐
│  Poll Details                   │
│  ─────────────────────────      │
│  Status: Ended ✅               │
│  Time: 0 minutes                │
│                                 │
│  [🔓 Request Decryption]       │  ← 应该看到这个按钮
└─────────────────────────────────┘
```

### 步骤 2：点击后弹出模态框
```
┌─────────────────────────────────────┐
│  ┌───────────────────────────────┐ │
│  │  🔄 Gateway 解密中...         │ │
│  │  ████████████░░░░░░░ 65%     │ │
│  │                               │ │
│  │  🔐 Zama Gateway 正在解密... │ │
│  │  预计需要 30-60 秒           │ │
│  │                               │ │
│  │  ⏳ 请耐心等待，不要关闭页面 │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 步骤 3：完成后
```
┌─────────────────────────────────────┐
│  ┌───────────────────────────────┐ │
│  │  ✅ 解密完成！                │ │
│  │  ███████████████████ 100%    │ │
│  │                               │ │
│  │  ✅ 投票结果已成功解密并上链 │ │
│  │                               │ │
│  │  [ ✅ 查看结果 ]             │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## 🐛 调试清单

请按照这个清单检查：

- [ ] 浏览器已刷新（Ctrl + Shift + R）
- [ ] 控制台没有错误
- [ ] 钱包已连接
- [ ] 网络是 Sepolia
- [ ] 投票已创建
- [ ] 投票已结束（状态显示 "Ended"）
- [ ] 看到 "Request Decryption" 按钮
- [ ] 点击按钮
- [ ] 在钱包确认交易
- [ ] 看到进度模态框

---

## 💡 最简单的测试方法

如果上面的都不行，试试这个：

1. **完全关闭浏览器**（不是标签页，是整个浏览器）
2. **重新打开浏览器**
3. **访问** http://localhost:3000
4. **按 F12** 打开控制台
5. **连接钱包**
6. **创建投票**（持续时间 0.01 小时）
7. **投票**
8. **等待 1 分钟**
9. **刷新页面**
10. **点击 "Request Decryption"**

---

## 📞 需要帮助

如果还是看不到进度条，请告诉我：

1. **当前在哪个页面？**
   - 首页？
   - 投票详情页？

2. **投票状态是什么？**
   - Active（进行中）？
   - Ended（已结束）？

3. **是否看到 "Request Decryption" 按钮？**
   - 看到了，但点击没反应？
   - 没有看到这个按钮？

4. **浏览器控制台有什么错误？**
   - 截图发给我

我会帮您快速解决！😊



